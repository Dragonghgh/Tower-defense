<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Poker Tower Defense</title>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.55.2/dist/phaser.min.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            background-color: #1a1a1a;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            overflow: hidden;
        }
        #game-container {
            width: 800px;
            height: 600px;
            margin: 0 auto;
        }
    </style>
</head>
<body>
    <div id="game-container"></div>
    <script>
        // Menu Scene
        class MenuScene extends Phaser.Scene {
            constructor() {
                super('MenuScene');
            }

            preload() {
                // Load placeholder background (can replace with actual image)
                this.load.image('background', 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mP8z8BQDwAFhQHQw2hF4AAAAABJRU5ErkJggg==');
            }

            create() {
                // Create solid color background
                this.add.rectangle(400, 300, 800, 600, 0x2a2a2a);
                
                // Game title
                this.add.text(400, 150, 'Poker Tower Defense', {
                    fontSize: '48px',
                    fill: '#fff',
                    fontFamily: 'Arial',
                    stroke: '#000',
                    strokeThickness: 4
                }).setOrigin(0.5);
                
                // Start button
                const startButton = this.add.rectangle(400, 300, 200, 60, 0x4CAF50)
                    .setInteractive()
                    .on('pointerdown', () => this.scene.start('GameScene'));
                
                this.add.text(400, 300, 'Start Game', {
                    fontSize: '24px',
                    fill: '#fff',
                    fontFamily: 'Arial'
                }).setOrigin(0.5);
                
                // Instructions
                this.add.text(400, 400, 'Defend against the poker chips!\nPlace dealers, staff and managers\nto stop them reaching the end.', {
                    fontSize: '18px',
                    fill: '#fff',
                    fontFamily: 'Arial',
                    align: 'center'
                }).setOrigin(0.5);
            }
        }

        // Game Scene
        class GameScene extends Phaser.Scene {
            constructor() {
                super('GameScene');
                
                this.towers = [];
                this.enemies = [];
                this.path = [];
                this.money = 100;
                this.lives = 10;
                this.wave = 0;
                this.towerTypes = [
                    { name: 'Dealer', cost: 50, range: 150, damage: 10, cooldown: 1000, color: 0xff0000 },
                    { name: 'Staff', cost: 100, range: 200, damage: 15, cooldown: 800, color: 0x00ff00 },
                    { name: 'Manager', cost: 200, range: 250, damage: 25, cooldown: 600, color: 0x0000ff }
                ];
                this.selectedTower = null;
            }

            preload() {
                // Load placeholder images (can replace with actual images)
                this.load.image('path', 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mP8z8BQDwAFhQHQw2hF4AAAAABJRU5ErkJggg==');
                this.load.image('poker-chip-enemy', 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mP8z8BQDwAFhQHQw2hF4AAAAABJRU5ErkJggg==');
            }

            create() {
                // Create path (simple straight path)
                this.path = this.add.rectangle(400, 300, 600, 50, 0x8B4513);
                
                // UI Elements
                this.moneyText = this.add.text(20, 20, `Money: $${this.money}`, { fontSize: '24px', fill: '#fff' });
                this.livesText = this.add.text(20, 50, `Lives: ${this.lives}`, { fontSize: '24px', fill: '#fff' });
                this.waveText = this.add.text(20, 80, `Wave: ${this.wave}`, { fontSize: '24px', fill: '#fff' });
                
                // Tower selection buttons
                this.towerButtons = [];
                this.towerTypes.forEach((tower, index) => {
                    const button = this.add.rectangle(700, 100 + (index * 100), 120, 80, tower.color)
                        .setInteractive()
                        .on('pointerdown', () => {
                            this.selectedTower = index;
                        });
                    
                    this.add.text(700, 100 + (index * 100), `${tower.name}\n$${tower.cost}`, {
                        fontSize: '16px',
                        fill: '#fff',
                        align: 'center'
                    }).setOrigin(0.5);
                    
                    this.towerButtons.push(button);
                });
                
                // Start wave button
                this.startWaveButton = this.add.rectangle(700, 400, 120, 60, 0x4CAF50)
                    .setInteractive()
                    .on('pointerdown', this.startWave.bind(this));
                
                this.add.text(700, 400, 'Start Wave', { fontSize: '18px', fill: '#fff' }).setOrigin(0.5);
                
                // Tower placement
                this.input.on('pointerdown', (pointer) => {
                    if (this.selectedTower !== null && 
                        this.money >= this.towerTypes[this.selectedTower].cost && 
                        !Phaser.Geom.Rectangle.Contains(this.path.getBounds(), pointer.x, pointer.y)) {
                        
                        this.placeTower(pointer.x, pointer.y, this.selectedTower);
                    }
                });
            }

            update() {
                // Update enemies
                this.enemies.forEach((enemy, index) => {
                    enemy.x += enemy.speed;
                    
                    // Check if enemy reached end
                    if (enemy.x > 800) {
                        this.enemies.splice(index, 1);
                        enemy.destroy();
                        this.lives--;
                        this.livesText.setText(`Lives: ${this.lives}`);
                        
                        if (this.lives <= 0) {
                            this.gameOver();
                        }
                    }
                });
                
                // Update towers
                this.towers.forEach(tower => {
                    if (tower.cooldown <= 0) {
                        const target = this.findEnemyInRange(tower);
                        if (target) {
                            this.attack(tower, target);
                            tower.cooldown = tower.type.cooldown;
                        }
                    } else {
                        tower.cooldown -= this.game.loop.delta;
                    }
                });
            }

            placeTower(x, y, typeIndex) {
                const type = this.towerTypes[typeIndex];
                
                this.money -= type.cost;
                this.moneyText.setText(`Money: $${this.money}`);
                
                const tower = {
                    sprite: this.add.circle(x, y, 20, type.color),
                    type: type,
                    cooldown: 0
                };
                
                this.towers.push(tower);
            }

            findEnemyInRange(tower) {
                for (const enemy of this.enemies) {
                    const distance = Phaser.Math.Distance.Between(
                        tower.sprite.x, tower.sprite.y,
                        enemy.x, enemy.y
                    );
                    
                    if (distance <= tower.type.range) {
                        return enemy;
                    }
                }
                return null;
            }

            attack(tower, enemy) {
                // Visual effect
                const line = this.add.graphics();
                line.lineStyle(2, 0xffffff);
                line.lineBetween(tower.sprite.x, tower.sprite.y, enemy.x, enemy.y);
                this.time.delayedCall(100, () => line.destroy());
                
                // Damage enemy
                enemy.health -= tower.type.damage;
                
                if (enemy.health <= 0) {
                    this.enemies = this.enemies.filter(e => e !== enemy);
                    enemy.destroy();
                    this.money += 10;
                    this.moneyText.setText(`Money: $${this.money}`);
                }
            }

            startWave() {
                this.wave++;
                this.waveText.setText(`Wave: ${this.wave}`);
                
                // Create poker chip enemies (using circles as placeholders)
                for (let i = 0; i < 5 + (this.wave * 2); i++) {
                    this.time.delayedCall(i * 500, () => {
                        const enemy = this.add.circle(-30, 300, 15, 0xFFFF00);
                        enemy.health = 20 + (this.wave * 5);
                        enemy.speed = 1 + (this.wave * 0.1);
                        this.enemies.push(enemy);
                    });
                }
            }

            gameOver() {
                this.add.text(400, 300, 'Game Over', {
                    fontSize: '48px',
                    fill: '#ff0000',
                    fontFamily: 'Arial'
                }).setOrigin(0.5);
                
                this.add.text(400, 350, `You survived ${this.wave} waves`, {
                    fontSize: '24px',
                    fill: '#fff',
                    fontFamily: 'Arial'
                }).setOrigin(0.5);
                
                // Add restart button
                const restartButton = this.add.rectangle(400, 420, 200, 60, 0x4CAF50)
                    .setInteractive()
                    .on('pointerdown', () => this.scene.restart());
                
                this.add.text(400, 420, 'Play Again', {
                    fontSize: '24px',
                    fill: '#fff',
                    fontFamily: 'Arial'
                }).setOrigin(0.5);
            }
        }

        // Game configuration
        const config = {
            type: Phaser.AUTO,
            width: 800,
            height: 600,
            backgroundColor: '#2d2d2d',
            parent: 'game-container',
            scene: [MenuScene, GameScene],
            scale: {
                mode: Phaser.Scale.FIT,
                autoCenter: Phaser.Scale.CENTER_BOTH
            }
        };

        // Create the game
        new Phaser.Game(config);
    </script>
</body>
</html>
